
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Spring in Practice</title>
  <meta name="author" content="Willie Wheeler">

  
  <meta name="description" content="It&rsquo;s been a little while since I&rsquo;ve posted Zkybase screenshots, so here&rsquo;s the work in progress. I explain how to implement this &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://springinpractice.com/blog/page/4">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Spring in Practice" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Forum' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-31137459-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <ul class="social-links">
    <li><a href="https://twitter.com/williewheeler"><img src="http://springinpractice.s3.amazonaws.com/blog/theme/icons/twitter.png" alt="Twitter" /></a></li>
    <li><a href="https://github.com/williewheeler"><img src="http://springinpractice.s3.amazonaws.com/blog/theme/icons/github.png" alt="GitHub" /></a></li>
    <li><a href="http://stackoverflow.com/users/41871/willie-wheeler"><img src="http://springinpractice.s3.amazonaws.com/blog/theme/icons/stackoverflow.png" alt="Stack Overflow" /></a></li>
    <li><a href="http://www.linkedin.com/in/williewheeler"><img src="http://springinpractice.s3.amazonaws.com/blog/theme/icons/linkedin.png" alt="LinkedIn" /></a></li>
  </ul>
  <h1><a href="/">Spring in Practice</a></h1>
  
    <h2>Willie Wheeler's Spring blog</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/archives/">Archives</a></li>
  <li><a href="/book/">The Book</a></li>
  <li><a href="/consulting/"><span style="padding-left:20px;background:url(http://springinpractice.com/images/leaf.png) left no-repeat">Spring Consulting</span></a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/01/17/more-skybase-screenshots/">More Zkybase Screenshots</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-17T13:30:03-08:00" pubdate data-updated="true">Jan 17<span>th</span>, 2012</time>
        
         | <a href="/2012/01/17/more-skybase-screenshots/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It&rsquo;s been a little while since I&rsquo;ve posted <a title="Zkybase GitHub site" href="https://github.com/williewheeler/zkybase">Zkybase</a> screenshots, so here&rsquo;s the work in progress. I explain how to implement this stuff (<a title="Spring Data Neo4j" href="http://www.springsource.org/spring-data/neo4j">Spring Data Neo4j</a>, <a title="Spring/GitHub integration" href="https://github.com/SpringSource/spring-social">Spring/GitHub integration</a>, <a title="JavaScript InfoVis Toolkit" href="http://thejit.org/">JavaScript InfoVis Toolkit</a>, etc.) in chapter 11 of my book <a title="Spring in Practice" href="http://manning.com/wheeler/">Spring in Practice</a> (Manning).</p>

<h2>App overview page</h2>

<p><img src="http://springinpractice.s3.amazonaws.com/blog/images/2012-01-17-more-skybase-screenshots/app_overview.png" alt="App overview" /></p>

<p>Applications are a central concept in Zkybase. This is how the app overview page looks so far. (It&rsquo;s just a start.) The concept behind it is that if you want a 360-degree view of an app (dev view, test view, release view and ops view), you come to the app details page and then you can start looking at different views.</p>

<h2>App repository commits page</h2>

<p><img src="http://springinpractice.s3.amazonaws.com/blog/images/2012-01-17-more-skybase-screenshots/commits.png" alt="Commits" /></p>

<p>Here&rsquo;s a repo commit history for a given app. Right now it&rsquo;s just integrated with GitHub, but the idea is to provide integrations with other providers too (e.g. BitBucket).</p>

<h2>App repository watchers page</h2>

<p><img src="http://springinpractice.s3.amazonaws.com/blog/images/2012-01-17-more-skybase-screenshots/watchers.png" alt="Watchers" /></p>

<p>Again, an app details view. This time it&rsquo;s GitHub watchers for a given app repo.</p>

<h2>Region details page</h2>

<p><img src="http://springinpractice.s3.amazonaws.com/blog/images/2012-01-17-more-skybase-screenshots/region.png" alt="Region" /></p>

<p>Visualizations are one of the more exciting features that a CMDB can offer. One of the huge advantages of putting your configuration management data in a database is that you can move away from Visio documents and Gliffy diagrams, and move instead toward data modeling and automatically generating views. Here I&rsquo;m using the <a title="JavaScript InfoVis Toolkit" href="http://thejit.org/">JavaScript InfoVis Toolkit </a>library to generate an interactive graph visualization. It is a great complement to the underlying <a title="Neo4j" href="http://neo4j.org/">Neo4j</a> graph database.</p>

<h2>Automation view</h2>

<p><img src="http://springinpractice.s3.amazonaws.com/blog/images/2012-01-17-more-skybase-screenshots/xml.png" alt="XML" /></p>

<p>This might strike you as a strange screenshot, but in reality it&rsquo;s an example of the most important view&mdash;the automation view. The main reason we want to manage configuration data in a database is that we can build web services (Zkybase supports both JSON and XML views) that simultaneously drive automation and human-consumable views of the sort that a support team would use.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/01/14/skybasegithub-integration/">Zkybase/GitHub Integration</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-14T07:55:43-08:00" pubdate data-updated="true">Jan 14<span>th</span>, 2012</time>
        
         | <a href="/2012/01/14/skybasegithub-integration/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A major goal for <a title="Zkybase GitHub site" href="https://github.com/williewheeler/zkybase">Zkybase</a> is to tie together the activities of developers, testers, release engineers and operations. A few major benefits are:</p>

<ul>
<li><strong>Tool integration:</strong> We can single source app lists and more across development, build, test, deployment, monitoring, knowledge management and other tools.</li>
<li><strong>Process streamlining:</strong> Outputs from the dev process feed into the test and deployment processes, which in turn feed into operational processes.</li>
<li><strong>Communications across teams:</strong> All the teams work from the same concepts and data, facilitating communication.</li>
</ul>


<p>One of the first things I want to tackle in Zkybase, then, is supporting some developer-centric concerns. An important one is source control. Obviously Zkybase isn&rsquo;t itself a source control management system, but it makes sense to pull in useful information from the source code repos just to provide a &ldquo;single pane of glass&rdquo; where developers and other users can get a holistic view of what an app is all about.</p>

<p>Since I&rsquo;m using GitHub, Github integration is a logical starting point for Zkybase/SCM integration. GitHub has a <a title="GitHub REST API" href="http://developer.github.com/v3/">REST API</a> that makes this integration easy. I wrote a <a title="Calling the GitHub API using Springâ€™s RestTemplate" href="http://springinpractice.com/2012/01/14/calling-the-github-api-using-springs-resttemplate/">post</a> that explains the technical approach. Here&rsquo;s the end result:</p>

<p><img src="http://springinpractice.s3.amazonaws.com/blog/images/2012-01-14-skybasegithub-integration/skybase_scm4.png" alt="Zkybase SCM page" /></p>

<p>I suspect that such integrations will be a large part of the value that Zkybase delivers. They will help realize the process, tool and communications benefits I highlighted above.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/01/14/calling-the-github-api-using-springs-resttemplate/">Calling the GitHub API Using Spring&#8217;s RestTemplate</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-14T07:15:59-08:00" pubdate data-updated="true">Jan 14<span>th</span>, 2012</time>
        
         | <a href="/2012/01/14/calling-the-github-api-using-springs-resttemplate/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>GitHub has an <a title="GitHub API" href="http://developer.github.com/">RESTful JSON API</a> that we can call from our apps. In this post I&rsquo;ll show how I&rsquo;m grabbing a GitHub repo&rsquo;s watchers and pull them into my own app using Spring&rsquo;s RestTemplate.</p>

<h2>Meet the GitHub API</h2>

<p>First, take a quick look at the <a title="GitHub Repo Watching API" href="http://developer.github.com/v3/repos/watching/">GitHub Repo Watching API</a>. It&rsquo;s pretty simple, and it doesn&rsquo;t require credentials to call. The URL for my <a title="Zkybase GitHub site" href="https://github.com/williewheeler/zkybase">Zkybase</a> project, for example, is <a title="Zkybase watchers" href="https://api.github.com/repos/williewheeler/zkybase/watchers"><a href="https://api.github.com/repos/williewheeler/zkybase/watchers">https://api.github.com/repos/williewheeler/zkybase/watchers</a></a>.</p>

<p>Go ahead and click the watcher link above. You&rsquo;ll see that the response is a JSON array of watcher objects.</p>

<p>Note that since the GitHub API is HTTPS-based, you will need to download the GitHub API certificate (using, e.g., openssl) and then import it into your Java keystore (using keytool) so your Java programs can call the API without running into certificate errors.</p>

<h2>Create a User class for object/JSON mapping</h2>

<p>We&rsquo;re going to use <a title="Jackson JSON processor" href="http://jackson.codehaus.org/">Jackson</a> to map the GitHub JSON to Java objects. We&rsquo;ll need a <code>User</code> class for that. Here it is:</p>

<pre><code>package org.skydingo.zkybase.integrations.github.model;

import org.codehaus.jackson.annotate.JsonProperty;

public class User {
    private Long id;
    private String url, login, avatarUrl, gravatarId;

    public Long getId() { return id; }

    public void setId(Long id) { this.id = id; }

    public String getUrl() { return url; }

    public void setUrl(String url) { this.url = url; }

    public String getLogin() { return login; }

    public void setLogin(String login) { this.login = login; }

    @JsonProperty("avatar_url")
    public String getAvatarUrl() { return avatarUrl; }

    public void setAvatarUrl(String avatarUrl) { this.avatarUrl = avatarUrl; }

    @JsonProperty("gravatar_id")
    public String getGravatarId() { return gravatarId; }

    public void setGravatarId(String gravatarId) { this.gravatarId = gravatarId; }
}
</code></pre>

<p>Nothing too amazing here. Note that I&rsquo;m using <code>@JsonProperty</code> to clarify the mapping from the <code>avatar_url</code> and <code>gravatar_id</code> JSON fields to the <code>avatarUrl</code> and <code>gravatarId</code> Java properties, since Jackson doesn&rsquo;t automatically handle underscores or anything like that.</p>

<p>The Maven dependency for the <code>@JsonProperty</code> annotation is</p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.codehaus.jackson&lt;/groupId&gt;
    &lt;artifactId&gt;jackson-mapper-asl&lt;/artifactId&gt;
    &lt;version&gt;1.9.3&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<h2>Get the data using RestTemplate</h2>

<p>Now that we have <code>User</code>, all we need to do is grab the data using <code>RestTemplate</code>. Easy:</p>

<pre><code>package org.skydingo.zkybase.service;

import javax.inject.Inject;
import org.skydingo.zkybase.integrations.github.model.User;
import org.skydingo.zkybase.model.Application;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;

@Service
public class ApplicationService {
    private static final String GITHUB_WATCHER_URI =
        "https://api.github.com/repos/{user}/{repo}/watchers";

    @Inject private RestTemplate restTemplate;

    public User[] getGithubRepoWatchers(String user, String repo) {
        return restTemplate.getForObject(GITHUB_WATCHER_URI, User[].class, user, repo);
    }
}
</code></pre>

<p>Recall that GitHub returns an array of watchers. That&rsquo;s why we&rsquo;re using <code>User[].class</code> in the call. <code>RestTemplate</code> substitutes the <code>user</code> and <code>repo</code> values into the <code>GITHUB_WATCHER_URI</code> string for us.</p>

<h2>Spring configuration</h2>

<p>All we need to do is put a <code>RestTemplate</code> instance on the app context:</p>

<pre><code>&lt;bean class="org.springframework.web.client.RestTemplate" /&gt;
</code></pre>

<h2>Success!</h2>

<p>After a little hacking at the UI:</p>

<p><img src="http://springinpractice.s3.amazonaws.com/blog/images/2012-01-14-calling-the-github-api-using-springs-resttemplate/skybase_scm3.png" alt="Zkybase SCM page" /></p>

<p>See <a href="http://springinpractice.com/2012/01/14/skybasegithub-integration/">Zkybase/GitHub integration</a> for more context as to why we&rsquo;d want to integrate our CMDB with GitHub.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/01/07/making-formselect-work-nicely-using-spring-3-formatters/">Making Form:select Work Nicely Using Spring 3 Formatters</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-07T04:51:10-08:00" pubdate data-updated="true">Jan 7<span>th</span>, 2012</time>
        
         | <a href="/2012/01/07/making-formselect-work-nicely-using-spring-3-formatters/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When you&rsquo;re creating a web form, it&rsquo;s often the case that you want to give the user a way to connect one entity up to another entity. This post explains how to do this in a nice, clean way using Spring Formatters.</p>

<h2>A real-life example</h2>

<p>To make things concrete, let&rsquo;s use a real-life example. I&rsquo;m working on an open source CMDB called <a title="Zkybase GitHub site" href="https://github.com/williewheeler/zkybase">Zkybase</a> that has entities such as farms, environments and data centers. When the user creates or edits a farm, he needs to specify the environment in which the farm lives (e.g., Development, Test, Production, etc.) and also the data center (e.g., US West DC 1, US West DC 2, etc.). We want the user to select an environment and a data center using dropdowns, like so:</p>

<p><img src="http://springinpractice.s3.amazonaws.com/blog/images/2012-01-07-making-formselect-work-nicely-using-spring-3-formatters/farm_errors2.png" alt="New farm form" /></p>

<p>For edits, we obviously want the dropdowns to be preset to their current values. We want validation: in our example, all three fields are required. For both edits and creates, when the user submits an invalid farm (e.g., missing name), we want the environment and data center to be preset to whatever value the user just submitted. Standard stuff.</p>

<p>Let&rsquo;s look at three different approaches to solving this in Spring. The first two are ugly and the last one is clean. (If you&rsquo;re impatient, feel free to skip right to the third approach.)</p>

<h2>Approach #1 (ugly): ad hoc ID fields</h2>

<p>One approach is to create special fields on the <code>Farm</code> entity to hold the environment and data center IDs, and then write custom code in the controller to map these to <code>Environment</code> and <code>DataCenter</code> instances. Here&rsquo;s how such a <code>Farm</code> might look:</p>

<pre>public class Farm {
    private Long id;
    private String name;
    private Environment environment;
    private DataCenter dataCenter;
    private Long environmentId;
    private Long dataCenterId;

    ... getters and setters for id, name, environment and dataCenter ...

    @NotNull
    @Transient
    @XmlTransient
    public Long getEnvironmentId() { return environmentId; }

    public void setEnvironmentId(Long id) { this.environmentId = id; }

    @NotNull
    @Transient
    @XmlTransient
    public Long getDataCenterId() { return dataCenterId; }

    public void setDataCenterId(Long id) { this.dataCenterId = id; }
}</pre>


<p>And the form code looks something like this (I&rsquo;m suppressing some details just for clarity&rsquo;s sake):</p>

<pre>&lt;form:select path="environmentId"&gt;
    &lt;form:option value="" label="-- Choose one--" /&gt;
    &lt;form:options items="${environmentList}" itemValue="id" itemLabel="name" /&gt;
&lt;/form:select&gt;
&lt;form:errors path="environmentId"&gt;
    &lt;span class="help-inline"&gt;&lt;form:errors path="environmentId" /&gt;&lt;/span&gt;
&lt;/form:errors&gt;</pre>


<p>The approach works, but it&rsquo;s stinky for at least a couple of reasons:</p>

<ul>
    <li>It dirties up the `Farm` entity. We already have `Environment` and `DataCenter` properties, and each of those has an ID, so it&#8217;s redundant and annoying to have to include extra getters and setters to handle the IDs. If we&#8217;re doing ORM or OXM, it becomes very clear from the `@Transient` and `@XmlTransient` annotations that these extra ID properties aren&#8217;t really part of the entity at all; they&#8217;re purely supporting data transfer.</li>
    <li>It forces us to write custom code in the controller to map the IDs to an `Environment` and a `DataCenter` so we can, e.g., save it in the database using Hibernate or whatever.</li>
</ul>


<p>Now let&rsquo;s see a closely related approach that&rsquo;s a step in the right direction, but still stinky.</p>

<h2>Approach #2 (still ugly): use the referenced entities&#8217; ID properties</h2>

<p>Instead of using redundant ID properties, we can just leave the <code>Farm</code> alone (meaning it has an ID, a name, an environment and a data center, and no extra ID properties) and just point the form at the environment&rsquo;s and data center&rsquo;s IDs:</p>

<pre>&lt;form:select path="environment.id"&gt;
    &lt;form:option value="" label="-- Choose one--" /&gt;
    &lt;form:options items="${environmentList}" itemValue="id" itemLabel="name" /&gt;
&lt;/form:select&gt;
&lt;form:errors path="environment.id"&gt;
    &lt;span class="help-inline"&gt;&lt;form:errors path="environment.id" /&gt;&lt;/span&gt;
&lt;/form:errors&gt;</pre>


<p>Spring is fine with complex properties like this. And so this almost works. But there are once again a couple of issues:</p>

<ul>
    <li>Stylistically, it&#8217;s a bit inelegant to treat reference-backed properties in a special way. It would be cleaner to deal with `environment` and `dataCenter` instead of `environment.id` and `dataCenter.id`. Minor issue, but still worth considering.</li>
    <li>More seriously, validation (at least JSR-303 validation) doesn&#8217;t work properly anymore. Referencing `environment.id` in the form causes Spring to create an `Environment` instance automatically, even if the user picks &#8220;&#8211; Choose one &#8211;&#8221; with ID = &#8220;&#8221;. So the `environment` and `dataCenter` properties won&#8217;t ever be null. And we can&#8217;t put `@NotNull` on the environment and data center IDs, because they&#8217;re allowed (indeed, expected) to be null when creating new ones. So you end up having to write custom code to make sure that the IDs are whatever you want to see. Blech.</li>
</ul>


<p>OK, those are some approaches that aren&rsquo;t very clean. Fortunately Spring 3 has some features that clean things up.</p>

<h2>Approach #3 (good approach): use Formatters</h2>

<p>The best practice approach in Spring 3 is to use so-called <code>Formatters</code>. As this blog post is already pretty long, let&rsquo;s just jump right into the code. If you want to see more code details, check out the actual code at the <a title="Zkybase GitHub site" href="https://github.com/williewheeler/zkybase">Zkybase Github site</a>.</p>

<p>First, our entities don&rsquo;t have any ad hoc ID properties like we saw in approach #1 above. <strong>But you do need to implement <code>equals()</code> for your entities, or else form prepopulation won&rsquo;t happen.</strong></p>

<p>Next, here&rsquo;s what the form looks like:</p>

<pre>&lt;form:select path="environment"&gt;
    &lt;form:option value="" label="-- Choose one--" /&gt;
    &lt;form:options items="${environmentList}" itemValue="id" itemLabel="name" /&gt;
&lt;/form:select&gt;
&lt;form:errors path="environment"&gt;
    &lt;span class="help-inline"&gt;&lt;form:errors path="environment" /&gt;&lt;/span&gt;
&lt;/form:errors&gt;</pre>


<p>(Same thing for the <code>dataCenter</code> property.) Notice that we&rsquo;re not messing around with IDs at all, other than where we&rsquo;re telling the <code>&amp;lt;form:options&amp;gt;</code> tag which property to use for the option value, which is perfectly fine and legitimate.</p>

<p>Next we need to look at the controller. In earlier versions of Spring we would have had to register some JavaBeans <code>PropertyEditor</code>s in an <code>@InitBinder</code> method, but we don&rsquo;t have to do that anymore. All we have to do is make sure we&rsquo;re prepared to accept a <code>Farm</code> in our handler method, that we annotate it with <code>@Valid</code>, etc.:</p>

<pre>@RequestMapping(value = "/{id}", method = RequestMethod.PUT)
public String putEditForm(
        @PathVariable Long id,
        @ModelAttribute("formData") @Valid Farm formData,
        BindingResult result,
        Model model) {

    ...
}</pre>


<p>The method body doesn&rsquo;t matter so much for our current purpose&mdash;we can check for validity using <code>result.hasErrors()</code>, save the data if it&rsquo;s valid, return the invalid form if it&rsquo;s not, or whatever. The main thing is that the <code>Farm</code> will come populated with an <code>Environment</code> and a <code>DataCenter</code> (both having the right IDs set) if the user chose them, and they&rsquo;ll be null if the user didn&rsquo;t:</p>

<p><img src="http://springinpractice.s3.amazonaws.com/blog/images/2012-01-07-making-formselect-work-nicely-using-spring-3-formatters/farm_errors2.png" alt="Farm with validation errors" /></p>

<p>To make the magic work, we need to implement <code>Formatter</code>s to convert our environments and data centers back and forth to IDs. Regarding <code>Formatter</code>s, I&rsquo;ll let you read about them in the <a href="http://static.springsource.org/spring/docs/current/spring-framework-reference/html/validation.html#format">Spring Reference Documentation</a>; here I&rsquo;ll give some code examples. Here&rsquo;s the <code>EnvironmentFormatter</code>:</p>

<pre>package org.zkybase.formatter;

import java.text.ParseException;
import java.util.Locale;
import org.zkybase.model.Environment;
import org.springframework.format.Formatter;
import org.springframework.stereotype.Component;

@Component
public class EnvironmentFormatter implements Formatter&lt;Environment&gt; {

    @Override
    public String print(Environment environment, Locale locale) {
        return environment.getId().toString();
    }

    @Override
    public Environment parse(String id, Locale locale) throws ParseException {

        // IMPORTANT: This approach works only if your equals() method doesn't compare fields
        // beyond the ID. If it does, then you'll need those fields set too. Consider simply
        // loading the entity from the database.
        Environment environment = new Environment();
        environment.setId(Long.parseLong(id));
        return environment;
    }
}</pre>


<p>One more thing we have to do is configure the formatters in our Spring configuration. Here&rsquo;s what that looks like (Spring 3.0.6+; I&rsquo;m suppressing the namespace declarations):</p>

<pre>&lt;context:component-scan base-package="org.zkybase.formatter" /&gt;

&lt;bean id="conversionService"
    class="org.springframework.format.support.FormattingConversionServiceFactoryBean"&gt;
    &lt;property name="formatters"&gt;
        &lt;set&gt;
            &lt;ref bean="dataCenterFormatter" /&gt;
            &lt;ref bean="environmentFormatter" /&gt;
        &lt;/set&gt;
    &lt;/property&gt;
&lt;/bean&gt;

&lt;mvc:annotation-driven conversion-service="conversionService" /&gt;</pre>


<p>This tells Spring Web MVC to use the conversion service both when rendering the form and when processing submitted form data. We won&rsquo;t go into all the gory details here since they&rsquo;re not necessarily important to making the whole thing work, but the formatter&rsquo;s <code>print()</code> method is the one that handles form rendering, and the formatter&rsquo;s <code>parse()</code> method handles turning the IDs in the HTML into entities in the Java controller.</p>

<p><strong>Quick tip regarding Firefox.</strong> Before I close, I wanted to offer a quick tip. When you&rsquo;re implementing and troubleshooting this stuff, be aware that <a href="http://stackoverflow.com/questions/4862606/when-using-html-select-tag-changed-selected-value-not-displayed-in-firefox">Firefox has a feature where it remembers your most recently submitted form values when you hit the refresh button</a> instead of resetting the form to its default settings. The feature helps users avoid data loss, but for developers it&rsquo;s a pain because you have to reload the page from the actual address bar (click in there and hit Enter) instead of refreshing the page. I didn&rsquo;t know this and the form was not responding to my code changes in the way I expected.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/01/03/closed-loops-the-secret-to-collecting-configuration-management-data/">Closed Loops: The Secret to Collecting Configuration Management Data</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-03T04:45:19-08:00" pubdate data-updated="true">Jan 3<span>rd</span>, 2012</time>
        
         | <a href="/2012/01/03/closed-loops-the-secret-to-collecting-configuration-management-data/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hi all, Willie here. Happy New Year!</p>

<p>In my last post, <a href="http://springinpractice.com/2011/12/26/devops-how-not-to-collect-configuration-management-data/">Devops: How NOT to collect configuration management data</a>, I gave a quick rundown of some losing CM data approaches that I and others have attempted in the past. Most of these approaches were variants of asking people for information, putting their answers in documents somewhere and never looking at the documents again.</p>

<p>This time around I&rsquo;m going to describe a key breakthough that our team finally made&mdash;one that made it a lot easier to collect and update the data in question.</p>

<p>That breakthrough was the concept of a <em>closed loop</em> and how it relates to configuration management.</p>

<p>[As it happens, the concept is well-known in configuration management circles, but at the time it wasn&rsquo;t well-known to us. So we discovered something that other people already knew. It&rsquo;s in that limited sense I say we made a breakthrough.]</p>

<p>We&rsquo;re going to have to build up to the closed loop concept. Let&rsquo;s start by looking at who has the best CM data in the org.</p>

<h2>Who has the best CM data?</h2>

<p>Different orgs are different, so it&rsquo;s tough to make blanket statements about who has the best CM data. But what I can do is give the answer for my workplace, and hopefully the principles will make sense even if the reality is different where you work. But I&rsquo;ll bet for a lot of orgs it&rsquo;s quite similar.</p>

<p>To avoid keeping you in suspense, the answer is&hellip;</p>

<p><strong>Winner: the release team.</strong> Where I work, the release team has the best CM data, where &ldquo;best&rdquo; means something like comprehensive, accurate and actively managed. The release team knows which apps go on which servers, which service accounts to launch Tomcat or JBoss under, which alerts to suppress during a deployment, and so on. They know these things across the entire range of apps they support. It&rsquo;s all documented (in YAML files, databases, scripts, etc.) and it&rsquo;s all maintained in real time.</p>

<p>Let&rsquo;s look at some other teams though.</p>

<ul>
<li><strong>App teams have nonsystematic data.</strong> The app teams typically know the URLs for their apps, which servers their apps are on (or at least the VIPs), the interdependencies between their apps and other adjacent systems (web services, databases). But the knowledge is less systematic. It&rsquo;s more like browser bookmarks, tribal knowledge and not-quite-up-to-date wiki pages. And any given developer knows his own app and maybe the last app or two he worked on, but not all apps.****</li>
<li><strong>Ops teams have to depend on busy developers for info.</strong> The ops teams have better or worse information depending on how close to the app teams they are. The team in the NOC is almost entirely at the mercy of the app teams to write and update knowledge base articles. As you might imagine, it can be a challenge to ensure that developers up against a deadline are writing solid KB articles and maintaining older ones. For the NOC it&rsquo;s very important to know who the app SMEs are, given such challenges. Even this is not always readily clear as org changes occur, new apps appear, old apps get new names and so on.</li>
<li><strong>App support teams are more expertise-driven than data-driven.</strong> The app support teams (they handle escalations out of the NOC) are generally more familiar with the apps themselves and so build up stronger knowledge about the apps, but this knowledge tends to be stronger with &ldquo;problem child&rdquo; apps. Also, different people tend to develop expertise with specific apps.</li>
</ul>


<h2>Why does the release team have the best CM data?</h2>

<p>The release team has the best CM data because properly maintained CM data is fundamental to their job in a way that it&rsquo;s not for other teams.</p>

<blockquote><p>First, a quick aside. If your company isn&rsquo;t regulated by <a href="http://en.wikipedia.org/wiki/Sarbanes%E2%80%93Oxley_Act">SOX</a>, you may be wondering about what a release team is and why we have one. Among many other things, SOX requires a separation of duties between people who write software and people who deploy/support it in the production environment. The release team&rsquo;s primary responsibility is to release software into production. We actually have a couple of release teams, and each of them services many apps. It would not be feasible from a cost and utilization perspective for each app team to have its own dedicated release engineer. The release teams release software at low-volume times, generally during the wee hours.</p></blockquote>

<p>Back to this idea that the release team needs proper CM data more than the other teams do. Why am I saying that?</p>

<p><img src="http://springinpractice.s3.amazonaws.com/blog/images/2012-01-03-closed-loops-the-secret-to-collecting-configuration-management-data/scrum.jpg" alt="Scrum" /></p>

<p><strong>Here&rsquo;s why.</strong> The software development team is highly motivated to release software at a regular cadence. A fairly limited number of release engineers must service hundreds of applications (generally not all at once, though), so &ldquo;tribal knowledge&rdquo; isn&rsquo;t a viable strategy when it comes to knowing what to deploy where. It must be thoroughly and accurately documented. Releases happen every week, and late at night, so it&rsquo;s not reasonable for the release team to call up his buddy on the app team and ask for the list of app servers. The release team needs this information at their fingertips. If they don&rsquo;t have it, the software organization fails to realize the value of its development investment.</p>

<p>Indeed, &ldquo;documented&rdquo; is the wrong word here, because deployment automation drives the deployments. The CM data must be properly &ldquo;operationalized&rdquo;, meaning that it must be consumable by automation. No Word docs, no Excel spreadsheets, no wiki pages. More like YAML files, XML files, web service calls against a CMDB, etc.</p>

<p>Importantly, when the data is wrong, the deployment fails. People really care about deployments not failing, so if there are data problems, people will definitely discover and fix them.</p>

<p>Let&rsquo;s look at the app and ops teams again.</p>

<ul>
<li><strong>App teams can make do without great CM data.</strong> The dependency of app developers on their CM data is softer. Yes, a developer needs to know which web services his app calls, but someone just explains that when he joins the project, and that&rsquo;s really all there is to it. If he has a question about a transitive dependency, he might ask a teammate. If he needs to get to the app in the test environment, he probably has the URL bookmarked and the credentials recorded somewhere, but if not, he can easily ask somebody. 99% of the time, the developer can do what he needs to do without reference to specific CM data points. The developer may or may not automate against the CM data.</li>
<li><strong>Ops/support teams need good CM data, but expertise is cheaper in the short- to medium-term.</strong> Except in cases involving very aggressive SLAs, even ops often has a softer dependency on CM data than the release team does. Since (hopefully) app outages occur much less frequently than app deployments, the return on knowledge base investments is more sporadic than that on deployment automation. If the app in question isn&rsquo;t particularly important, investments in KB articles may be very limited indeed. In most cases, investing in serious support firepower (when something breaks, bring significant subject matter expertise to bear on the problem) yields a better short- to medium-term return. (Of course, in the longer term this strategy fails, because eventually there will be the very costly outage that takes the business out for several days. That&rsquo;s a subject for a different day.)</li>
</ul>


<p>Now we&rsquo;re in a good place to understand closed loops and why they&rsquo;re so important for configuration management data.</p>

<h2>Closed loops and why they matter</h2>

<p>I think of closed loops like this. There&rsquo;s a &ldquo;steady state&rdquo; that we want to establish and maintain with respect to our CM data. We want it to be comprehensive, accurate and relevant. When the state of our CM data diverges from that desired steady state, we want feedback loops to alert us to the situation so we can address it. That&rsquo;s a closed loop.</p>

<p><strong>Example 1: deployment automation.</strong> The best example is the one that we already described: deployment data. Deployment data drives the deployment process, and when the data is wrong, the deployment process fails. Because the deployment process is extremely important to the organization, some level of urgency attaches to fixing wrong data. But it&rsquo;s not just wrong data. If we need to deploy an app and there&rsquo;s missing data in the CMDB, then sorry, there&rsquo;s no deployment! Rest assured that if the deployment matters, the missing data is only a temporary issue.</p>

<p><strong>Example 2: fine-grained access controls.</strong> Here&rsquo;s another example: team membership data. We&rsquo;ve already noted that for operational reasons it&rsquo;s very important to know who is on which development team. This isn&rsquo;t something that&rsquo;s going to be in the HR system, and people have better things to do than to update team membership data. But what happens when that team membership data drives ACLs for something you care about being able to do, like deploying your app to your dev environment? Now you&rsquo;re going to see better team membership data.</p>

<p>The basic concept is to find something that people really, really care about, and then make it strongly dependent on having good CM data:</p>

<p><img src="http://springinpractice.s3.amazonaws.com/blog/images/2012-01-03-closed-loops-the-secret-to-collecting-configuration-management-data/closed_loop.png" alt="Closed loop" /></p>

<p>Ideally it&rsquo;s best if the CM data drives an automated process that people care about, but that&rsquo;s not strictly necessary. In my org, for instance, there&rsquo;s a fairly robust but manual goal planning and goal tracking process. Every quarter the whole department goes through a goal planning process (my goals roll up into my boss&#8217; goals and so on), and then we track progress against those goals every couple of weeks. The goal planning and tracking app requires correct information about who&rsquo;s on which team, and so this serves to establish yet another closed loop on the team membership data. It also illustrates the point that you can hit the same type of data with multiple loops.</p>

<h2>Design your CM strategy holistically</h2>

<p>There are several areas in technology where it pays to take a holistic view of design: security, user experience and system testing come immediately to mind. In each case you consider a given technical system in its wider organizational context. (Super-duper-strong password requirements don&rsquo;t help if people have to write them down on Post-Its.)</p>

<p>Configuration management is another place where it makes lots of sense to take a holistic approach to design. For any given type of data (there&rsquo;s no one-size-fits-all answer here), try to figure out something important that depends on it, and then figure out how to tie that something to your data so that wheels just start falling off if the data is wrong, incomplete and so on. Again, data-driven automated processes are superior here, but any important process (automated or not) will help.</p>

<h2>Fewer meetings?</h2>

<p>Almost forgot. In the last post, I mentioned that I&rsquo;ll equip you to get out of some pointless meetings. The meetings in question are the ones where somebody wants to get together with you to collect CM data from you so they can post it to their Sharepoint site. Decline those&mdash;they&rsquo;re just a waste of time. Insist that people be able to articulate the closed loops that they will be creating to make sure that someone discovers gaps and errors in the data. I&rsquo;ve been in plenty of such meetings, and in some cases they&rsquo;re set up as half- or full-day meetings. I don&rsquo;t do those anymore.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/12/29/its-back-the-classpathscanningjaxb2marshaller/">ClasspathScanningJaxb2Marshaller</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-29T13:03:00-08:00" pubdate data-updated="true">Dec 29<span>th</span>, 2011</time>
        
         | <a href="/2011/12/29/its-back-the-classpathscanningjaxb2marshaller/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>By default, Spring&rsquo;s <code>&lt;oxm:jaxb2-marshaller&gt;</code> tag uses the <a href="http://static.springsource.org/spring/docs/3.1.x/javadoc-api/org/springframework/oxm/jaxb/Jaxb2Marshaller.html">Jaxb2Marshaller</a> class. It&rsquo;s painful to use, though, if you have a lot of classes, because you have to enumerate them all individually. There are a couple of options here:</p>

<ul>
<li>You can use one of the JAXB2 mechanisms (an <code>ObjectFactory</code> or an <code>jaxb.index</code> file; see <a href="http://docs.oracle.com/javase/6/docs/api/javax/xml/bind/JAXBContext.html">JAXBContext</a>).</li>
<li>You can use the marshaller&#8217;s <code>classesToBeBound</code> property.</li>
</ul>


<p>Both of these options require more work than they ought to. Here, for example, is what the <code>classesToBeBound</code> approach looks like:</p>

<pre>&lt;oxm:jaxb2-marshaller id="marshaller"&gt;
    &lt;oxm:class-to-be-bound name="org.skydingo.skybase.model.Database" /&gt;
    &lt;oxm:class-to-be-bound name="org.skydingo.skybase.model.DataCenter" /&gt;
    &lt;oxm:class-to-be-bound name="org.skydingo.skybase.model.Environment" /&gt;
    &lt;oxm:class-to-be-bound name="org.skydingo.skybase.model.Farm" /&gt;
    &lt;oxm:class-to-be-bound name="org.skydingo.skybase.model.Instance" /&gt;
    &lt;oxm:class-to-be-bound name="org.skydingo.skybase.model.Package" /&gt;
    &lt;oxm:class-to-be-bound name="org.skydingo.skybase.model.Package$MyListWrapper" /&gt;
    &lt;oxm:class-to-be-bound name="org.skydingo.skybase.model.Person" /&gt;
    &lt;oxm:class-to-be-bound name="org.skydingo.skybase.model.Project" /&gt;
    &lt;oxm:class-to-be-bound name="org.skydingo.skybase.model.Region" /&gt;
    &lt;oxm:class-to-be-bound name="org.skydingo.skybase.model.relationship.ProjectMembership" /&gt;
    &lt;oxm:class-to-be-bound name="org.skydingo.skybase.web.jit.JitNode" /&gt;

    ... and so forth ...

&lt;/oxm:jaxb2-marshaller&gt;</pre>


<p>Every time we add a new entity to the system, we have to go back to the list and add a corresponding entry. Blech.</p>

<p>About a year back I discovered a gem by <a href="https://twitter.com/#!/jwalgemoed">Jarno Walgemoed</a> called <code>ClasspathScanningJaxb2Marshaller</code>. Actually, I don&rsquo;t remember if that&rsquo;s its exact name, because his blog post no longer exists, but that&rsquo;s pretty close if not exactly it. At any rate, it uses Spring&rsquo;s classpath scanning mechanism (you know, the one that finds <code>@Component</code> and <code>@Repository</code> and so forth) to find classes annotated with <code>@XmlRootElement</code>, and then JAXB-binds them.</p>

<p>[EDIT: I found <a href="http://www.walgemoed.org/2010/12/jaxb2-spring-ws/">the original blog post</a> after all. &mdash; WLW]</p>

<p>Here&rsquo;s a slightly modified version of Jarno&rsquo;s class, reposted with his kind permission. (Thanks Jarno!) I&rsquo;ve used it on multiple projects and it works great.</p>

<pre>import java.util.ArrayList;
import java.util.List;
import java.util.Set;

import javax.annotation.PostConstruct;
import javax.xml.bind.annotation.XmlRootElement;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.config.BeanDefinition;
import org.springframework.context.annotation.ClassPathScanningCandidateComponentProvider;
import org.springframework.core.type.filter.AnnotationTypeFilter;
import org.springframework.oxm.jaxb.Jaxb2Marshaller;

public class ClasspathScanningJaxb2Marshaller extends Jaxb2Marshaller {
    private static final Logger log = LoggerFactory.getLogger(ClasspathScanningJaxb2Marshaller.class);
    
    private List basePackages;
    
    public List getBasePackages() { return basePackages; }
    
    public void setBasePackages(List basePackages) { this.basePackages = basePackages; }
    
    @PostConstruct
    public void init() throws Exception {
        setClassesToBeBound(getXmlRootElementClasses());
    }
    
    private Class[] getXmlRootElementClasses() throws Exception {
        ClassPathScanningCandidateComponentProvider scanner =
            new ClassPathScanningCandidateComponentProvider(false);
        scanner.addIncludeFilter(new AnnotationTypeFilter(XmlRootElement.class));
        
        List&lt;Class&gt; classes = new ArrayList&lt;Class&gt;();
        for (String basePackage : basePackages) {
            Set definitions = scanner.findCandidateComponents(basePackage);
            for (BeanDefinition definition : definitions) {
                String className = definition.getBeanClassName();
                log.info("Found class: {}", className);
                classes.add(Class.forName(className));
            }
        }
        
        return classes.toArray(new Class[0]);
    }
}</pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/12/28/initializing-lazy-loaded-collections-with-spring-data-neo4j/">Initializing Lazy-loaded Collections With Spring Data Neo4j</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-28T04:22:03-08:00" pubdate data-updated="true">Dec 28<span>th</span>, 2011</time>
        
         | <a href="/2011/12/28/initializing-lazy-loaded-collections-with-spring-data-neo4j/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Spring Data Neo4j has been around for about a year now, but the so-called &ldquo;simple mapping&rdquo; strategy (the one that doesn&rsquo;t use AspectJ) is new. So it doesn&rsquo;t have some of the bells and whistles that you might expect to see if you&rsquo;re coming from, say, Hibernate. In particular, it doesn&rsquo;t (as of Spring Data Neo4j 2.0.0.RELEASE) use proxies for collections.</p>

<p>The <a href="http://stackoverflow.com/questions/8218864/fetch-annotation-in-sdg-2-0-fetching-strategy-questions">question of how to initialize lazily loaded collections</a> came up on StackOverflow. Michael Hunger (Spring Data Neo4j lead) explained that you can use the Neo4jTemplate&rsquo;s fetch() method to perform the initialization. Here&rsquo;s some code showing how to do it:</p>

<pre>package org.skydingo.skybase.service.impl;

import javax.inject.Inject;
import org.skydingo.skybase.model.Person;
import org.skydingo.skybase.repository.PersonRepository;
import org.skydingo.skybase.service.PersonService;
import org.springframework.data.neo4j.support.Neo4jTemplate;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

@Service
@Transactional
public class PersonServiceImpl implements PersonService {
    @Inject private Neo4jTemplate template;
    @Inject private PersonRepository personRepo;

    @Override
    public Person findPersonDetails(Long id) {
        Person person = personRepo.findOne(id);
        template.fetch(person.getDirectReports());
        return person;
    }

    ... other methods ...
}</pre>


<p>Have fun.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/12/26/devops-how-not-to-collect-configuration-management-data/">Devops: How NOT to Collect Configuration Management Data</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-26T14:31:55-08:00" pubdate data-updated="true">Dec 26<span>th</span>, 2011</time>
        
         | <a href="/2011/12/26/devops-how-not-to-collect-configuration-management-data/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hi all, Willie here. This time we&rsquo;re going to step away from the keyboard and get architectural. But no ivory towers here. In my next two blog posts, I&rsquo;m going to give you something that will get you out of lots of pointless meetings.</p>

<p>Got your attention yet? Good!</p>

<p>If you&rsquo;re in devops, one of the things that you have to figure out is how to collect up all the information that will allow you to manage your configuration and also keep your apps up and running. This isn&rsquo;t too hard when you have two apps sitting on a single server. It&rsquo;s much harder when you have 400 apps deployed to thousands of servers across multiple environments and data centers.</p>

<p>So how do you do that? Let&rsquo;s start off by looking at some things that just don&rsquo;t work. In my next post I&rsquo;ll share with you an approach that <em>does</em> work.</p>

<h3>Some quick background</h3>


<p>Probably owing to some psychological glitch, I&rsquo;ve always been an information curator. Especially when I was in management, it was always important to me to understand exactly where my apps were deployed, which servers they were on, which services and databases they depended on, which servers <em>those</em> services and databases lived on, who are the SMEs for a given app, and so on.</p>

<p>If you work in a small environment, you&rsquo;re probably thinking, &ldquo;what&rsquo;s the big deal?&rdquo;</p>

<p>Well, I don&rsquo;t work in a small environment, but the first time I undertook this task, I probably would have said something like, &ldquo;no sweat.&rdquo; (That&rsquo;s the developer in me.) Anyway, for whatever reason, I decided that it was high time that somebody around the department could answer seemingly basic questions about our systems.</p>

<h3>Attempt #1: Wiki Wheeler</h3>


<p><img src="http://springinpractice.s3.amazonaws.com/blog/images/2011-12-26-devops-how-not-to-collect-configuration-management-data/bullwhip1.jpg" alt="Wiki Wheeler" /></p>

<p>The first time I made the attempt (several years ago), I was a director over a dozen or so app teams. So I created a wiki template with all the information that I wanted, and I chased after my teams to fill it out. My zeal was such that, unbeknownst to me, I acquired the nickname &ldquo;Wiki Wheeler&rdquo;. (One of my managers shared this heartwarming bit of information with me a couple years later.) I guess other managers liked the approach, though, because they chased after their teams too.</p>

<p>This approach started out decently well, since the teams involved could manage their own information, and since I was, well, Wiki Wheeler. But it didn&rsquo;t last. Through different system redesigns and department reorgs, wiki spaces came and went, some spaces atrophied from neglect, and there was redundant but contradictory information everywhere. The QA team had its own list, the release guys had their list, the app teams had their list. The UX guys might have even gotten in on the act. Anyway, after a year or so it was a big mess and to this day our wiki remains a big mess.</p>

<h3>Attempt #2: My huge Visio</h3>


<p><strong></strong>The second time, my approach was to collect the information from all the app development teams. We had hundreds of developers, so to make things efficient, I sent out a department-wide e-mail telling everybody that I was putting together a huge Visio document with all of our systems, and I&rsquo;d appreciate it if they could reply back with the requested information. And while I had to send out more nag e-mails than I would have liked, the end result was in fact a huge Visio diagram that had hundreds of boxes and lines going everywhere. I was very proud of this thing, and I printed out five or six copies on the department plotter and hung them on the walls.</p>

<p>How long do you think it was before it was out of date?</p>

<p>I have no idea. I seriously doubt that it was ever correct in the first place. Nobody (myself included) ever used the diagram to do actual work, and its chief utility was in making our workplace look somewhat more hardcore since there were huge color engineering plots on the walls.</p>

<p>There was one additional effect of this diagram, though I hesitate to call it utility. I acquired the wholly undeserved reputation for knowing what all these apps were and how they related to one another. This went on for years through no fault of my own. I mention it because it&rsquo;s relevant for the next attempt.</p>

<h3>Attempt #3: Disaster recovery</h3>


<p><img src="http://springinpractice.s3.amazonaws.com/blog/images/2011-12-26-devops-how-not-to-collect-configuration-management-data/asteroid.jpg" alt="When asteroids strike..." /></p>

<p>This one wasn&rsquo;t my attempt, but it&rsquo;s still worth describing since I have to imagine that we aren&rsquo;t the only ones who ever tried it.</p>

<p>As a rapidly growing company, disaster recovery became an increasingly big deal for us several years back, and there was a mandate from up high to put a plan in place. This involved collecting up all the information that would allow us to keep the business running if our primary data center ever got cratered. The person in charge of the effort spent about two years meeting with app teams or else &ldquo;experts&rdquo; (me, along with others who, like me, had only the highest-level understanding of how things were connected up) and documenting it on a Sharepoint site where nobody could see it.</p>

<p>This didn&rsquo;t work at all. Most people were too busy to meet with her, so the quality of the information was poor. Apps were misnamed, app suites were mistaken for apps, and to make a long story short, the result was not correct or maintainable.</p>

<h3>Attempt #4: Our external consultants&#8217; even bigger Visio</h3>


<p>Following a major reorg, we brought in some external consultants and they came up with their own Visio. By this time I had already figured out that interviewing teams and putting together huge Visios is a losing approach, so I was surprised that a bunch of highly-paid consultants would use it. Well, they did, and their diagram was, well, &ldquo;impressive&rdquo;. It was also (to put it gently) neither as helpful nor as maintainable as we would have liked.</p>

<h3>Attempt #5: HP uCMDB autodiscovery</h3>


<p>We have the HP uCMDB tool, and so our IT Services group ran some automated discovery agents to populate it with data. It loaded the uCMDB up with tons of fine-grained detail that nobody cared about, and we couldn&rsquo;t see the stuff that we actually did care about (like apps, web services, databases, etc.).</p>

<h3>Attempt #6: Service catalog</h3>


<p>Our IT Services group was pretty big on ITIL, so they went about putting together a service catalog. The person doing it collected service and app information into an Excel spreadsheet and posted it to a Sharepoint site. But this didn&rsquo;t really get into the details of configuration management. It was mostly around figuring out which business services we offered and which systems support which services.</p>

<p>They ended up printing out a glossy, full-color service catalog for the business, but nobody was really asking for it, so it was more of a curiosity than anything else.</p>

<p>There were other attempts too (Paul led a couple that I haven&rsquo;t even mentioned), but by now you get the picture.</p>

<h3>So why did these attempts fail?</h3>


<p>To understand why these attempts failed, it helps to look at what they had in common:</p>

<ul>
    <li>First, they generally involved trying to collect up information from SMEs and then putting it in some kind of document. This could be wiki pages, Visio diagrams, Word docs on Sharepoint or an Excel spreadsheet.</li>
    <li>Once the information went there, nobody used it. So the information, if it was ever correct and/or complete in the first place, was before long outdated, and there wasn&#8217;t any mechanism in place to bring it up to date.</li>
</ul>


<p>In general, people saw the problem as a data <em>collection</em> problem rather than a data <em>management</em> problem. There needs to be a systematic, ongoing mechanism to discover and fix errors. None of the approaches took the management problem seriously at all&mdash;they all simply assumed that the organization would care about the data enough to keep it up to date.</p>

<p>In the next installment, I&rsquo;ll tell you about the approach we eventually figured out. And as promised, that&rsquo;s also where I&rsquo;ll explain how to get rid of some of your meetings.</p>

<p><span class="icon stickyNote"><em>Interested in configuration management? I&rsquo;m working on an open source CMDB called <a href="http://zkybase.org/">Zkybase</a>.</em></span></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/12/17/domain-modeling-with-spring-data-neo4j-code/">Domain Modeling With Spring Data Neo4j</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-17T15:26:41-08:00" pubdate data-updated="true">Dec 17<span>th</span>, 2011</time>
        
         | <a href="/2011/12/17/domain-modeling-with-spring-data-neo4j-code/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hi all, Willie here. Last time I told you that I&rsquo;m building the <a href="https://github.com/williewheeler/zkybase">Zkybase</a> CMDB using <a title="Neo4j" href="http://neo4j.org/">Neo4j</a> and <a title="Spring Data Neo4j" href="http://www.springsource.org/spring-data/neo4j">Spring Data Neo4j</a>, and I was excited to get a lot of positive feedback about that. I showed a little code but not that much. In this post I&rsquo;ll show you how I&rsquo;m building out the person <a title="Configuration item" href="http://en.wikipedia.org/wiki/Configuration_item">configuration item</a> (CI) in Zkybase using Spring Data Neo4j.</p>

<h2>Person CI requirements</h2>

<p>We&rsquo;re going to start really simply here by building a person CI. It&rsquo;s useful to have people in the CMDB for various reasons: they allow you to define fine-grained access controls (e.g., Jim can deploy such-and-such apps to the development environment; Eric can deploy whatever he wants wherever he wants; etc.); they allow you to define groups who will receive notifications for critical events and incidents; etc.</p>

<p>Our person CI will have a username, first and last names, some phone numbers, an e-mail address, a manager, direct reports and finally projects he or she works on. We need to be able to display people in a list view, display a given person in a details view, allow users to create, edit and delete people and so on. Here for example is what the list view will look like, at least for now:</p>

<p><img src="http://springinpractice.s3.amazonaws.com/blog/images/2011-12-17-domain-modeling-with-spring-data-neo4j-code/person_list.png" alt="Person list" /></p>

<p>And here&rsquo;s how our details view will look:</p>

<p><img src="http://springinpractice.s3.amazonaws.com/blog/images/2011-12-17-domain-modeling-with-spring-data-neo4j-code/person_details.png" alt="Person details" /></p>

<p>The relationship between a person and a project has an associated role. This relationship is also the basis for the list of collaborators: two people are collaborators if there&rsquo;s at least one project of which they&rsquo;re both members.</p>

<p>Our simple requirements should be enough to show what it feels like to write Spring Data Neo4j code.</p>

<h2>Create the Person and ProjectMembership entities</h2>

<p>First we&rsquo;ll create the Person. I&rsquo;ve suppressed the validation and JAXB annotations since they&rsquo;re irrelevant for our current purposes:</p>

<pre>package org.skydingo.zkybase.model;

import java.util.Set;
import org.neo4j.graphdb.Direction;
import org.skydingo.zkybase.model.relationship.ProjectMembership;
import org.springframework.data.neo4j.annotation.*;
import org.springframework.data.neo4j.support.index.IndexType;

@NodeEntity
public class Person implements Comparable&lt;Person&gt; {
Â Â Â  @GraphId private Long id;

Â Â Â  @Indexed(indexType = IndexType.FULLTEXT, indexName = "searchByUsername")
Â Â Â  private String username;

Â Â Â  private String firstName, lastName, title, workPhone, mobilePhone, email;

Â Â Â  @RelatedTo(type = "REPORTS_TO")
Â Â Â  private Person manager;

Â Â Â  @RelatedTo(type = "REPORTS_TO", direction = Direction.INCOMING)
Â Â Â  private Set&lt;Person&gt; directReports;

Â Â Â  @RelatedToVia(type = "MEMBER_OF")
Â Â Â  private Set&lt;ProjectMembership&gt; memberships;

Â Â Â  public Long getId() { return id; }

Â Â Â  public void setId(Long id) { this.id = id; }

Â Â Â  public String getUsername() { return username; }

Â Â Â  public void setUsername(String username) { this.username = username; }

    ... other accessor methods ...

Â Â Â  public Person getManager() { return manager; }

Â Â Â  public void setManager(Person manager) { this.manager = manager; }

Â Â Â  public Set&lt;Person&gt; getDirectReports() { return directReports; }

Â Â Â  public void setDirectReports(Set&lt;Person&gt; directReports) {
Â Â Â Â Â Â Â  this.directReports = directReports;
Â Â Â  }

Â Â Â  public Iterable&lt;ProjectMembership&gt; getMemberships() { return memberships; }

Â Â Â  public ProjectMembership memberOf(Project project, String role) {
Â Â Â Â Â Â Â  ProjectMembership membership = new ProjectMembership(this, project, role);
Â Â Â Â Â Â Â  memberships.add(membership);
Â Â Â Â Â Â Â  return membership;
Â Â Â  }

    ... equals(), hashCode(), compareTo() ...
}</pre>


<p>There are lots of annotations we&rsquo;re using to put a structure in place. Let&rsquo;s start with nodes and their properties. Then we&rsquo;ll look at simple relationships between nodes. Then we&rsquo;ll look at so-called relationship entities, which are basically fancy relationships. First, here&rsquo;s an abstract representation of our domain model:</p>

<p><img src="http://springinpractice.s3.amazonaws.com/blog/images/2011-12-17-domain-modeling-with-spring-data-neo4j-code/abstract_graph.png" alt="Abstract graph" /></p>

<p>Now let&rsquo;s look at some details.</p>

<p><strong>Nodes and their properties.</strong> When we have a node-backed entity, first we annotate it with the @NodeEntity annotation. Most of the simple node properties (i.e., properties that aren&rsquo;t relationships to other nodes) come along for the ride. Notice that I didn&rsquo;t have to annotate firstName, lastName, email, and so forth. Spring Data Neo4j will handle the mapping there automatically.</p>

<p>There are a couple of exceptions though. The first one is that I put @GraphId on my id property. This tells Spring Data Neo4j that this is an identifier that we can use for lookups. The other one is the @Indexed annotation, which (surprise) creates an index for the property in question. This is useful when you want an alternative to ID-based lookup.</p>

<p>Now we&rsquo;ll look at relationships. Speaking broadly, there are simple relationships and more advanced relationships. We&rsquo;ll start with the simple ones.</p>

<p><strong>Simple relationships.</strong> At a low level, Neo4j is a graph database, so we can talk about the graph in graph theoretical terms like nodes, edges, directed edges, DAGs and all that. But here we&rsquo;re using graphs for domain modeling, so we interpret low-level graph concepts in terms of higher-level domain modeling concepts. The language that Spring Data Neo4j uses is &ldquo;node entity&rdquo; for nodes, and &ldquo;relationships&rdquo; for edges.</p>

<p>Our Person CI has a simple relationship, called REPORTS_TO, that relates people so we can model reporting hierarchies. Person has two fields for this relationship: manager and directReports. These are opposite sites of the same relationship. We use @RelatedTo(type = &ldquo;REPORTS_TO&rdquo;) to annotate these fields. The annotation has a direction element as well, whose default value is Direction.OUTGOING, which means that &ldquo;this&rdquo; node is the edge tail. That&rsquo;s why we specify direction = Direction.INCOMING explicitly for the directReports field.</p>

<p>What&rsquo;s this look like in the database? <a title="Neoclipse site" href="http://wiki.neo4j.org/content/Neoclipse">Neoclipse</a> reveals all. Here are some example reporting relationships (click the image for a larger view):</p>

<p><img src="http://springinpractice.s3.amazonaws.com/blog/images/2011-12-17-domain-modeling-with-spring-data-neo4j-code/reports_to_graph.png" alt="Reports-to graph" /></p>

<p>(Small aside: there&rsquo;s a <code>@Fetch</code> annotation&mdash;we&rsquo;ll see it in a moment&mdash;that tells Spring Data Neo4j to eager load a related entity. For some reason I&rsquo;m not having to use it for the manager and direct reports relationships, and I&rsquo;m not sure why. If somebody knows, I&rsquo;d appreciate the explanation.)</p>

<p><strong>Relationship entities.</strong> Besides the REPORTS_TO relationship between people, we care about the MEMBER_OF relationship between people and projects. This one&rsquo;s more interesting than the REPORTS_TO relationship because MEMBER_OF has an associated property&mdash;role&mdash;that&rsquo;s analogous to adding a column to a link table in a RDBMS, as I mentioned in my reply to Brig in the last post. The Person.memberOf() method provides a convenient way to assign a person to a project using a special ProjectMembership &ldquo;relationship entity&rdquo;. Here&rsquo;s the code:</p>

<pre>package org.skydingo.zkybase.model.relationship;

import org.skydingo.zkybase.model.Person;
import org.skydingo.zkybase.model.Project;
import org.springframework.data.neo4j.annotation.*;

@RelationshipEntity(type = "MEMBER_OF")
public class ProjectMembership {
Â Â Â  @GraphId private Long id;
Â Â Â  @Fetch @StartNode private Person person;
Â Â Â  @Fetch @EndNode private Project project;
Â Â Â  private String role;

Â Â Â  public ProjectMembership() { }

Â Â Â  public ProjectMembership(Person person, Project project, String role) {
Â Â Â Â Â Â Â  this.person = person;
Â Â Â Â Â Â Â  this.project = project;
Â Â Â Â Â Â Â  this.role = role;
Â Â Â  }

Â Â Â  public Person getPerson() { return person; }

Â Â Â  public void setPerson(Person person) { this.person = person; }

Â Â Â  public Project getProject() { return project; }

Â Â Â  public void setProject(Project project) { this.project = project; }

Â Â Â  public String getRole() { return role; }

Â Â Â  public void setRole(String role) { this.role = role; }

Â Â Â  ... equals(), hashCode(), toString() ...

}</pre>


<p>ProjectMembership, like Person, is an entity, but it&rsquo;s a relationship entity. We use @RelationshipEntity(type = &ldquo;MEMBER_OF&rdquo;) to mark this as a relationship entity, and as with the Person, we use @GraphId for the id property. The @StartNode and @EndNode annotations indicate the edge tail and head, respectively. @Fetch tells Spring Data Neo4j to load the nodes eagerly. By default, Spring Data Neo4j doesn&rsquo;t eagerly load relationships since risks loading the entire graph into memory.</p>

<h2>Create the PersonRepository</h2>

<p>Here&rsquo;s our PersonRepository interface:</p>

<pre>package org.skydingo.zkybase.repository;

import java.util.Set;
import org.skydingo.zkybase.model.Person;
import org.skydingo.zkybase.model.Project;
import org.springframework.data.neo4j.annotation.Query;
import org.springframework.data.neo4j.repository.GraphRepository;

public interface PersonRepository extends GraphRepository&lt;Person&gt; {

Â Â Â  Person findByUsername(String username);

Â Â Â  @Query("start project=node({0}) match project&lt;--person return person")
Â Â Â  Set&lt;Person&gt; findByProject(Project project);

Â Â Â  @Query(
        "start person=node({0}) " +
        "match person-[:MEMBER_OF]-&gt;project&lt;-[:MEMBER_OF]-collaborator " +
        "return collaborator")
Â Â Â  Set&lt;Person&gt; findCollaborators(Person person);
}</pre>


<p class="size-medium wp-image-215" title="repos">I noted in the last post that all we need to do is extend the GraphRepository interface; Spring Data generates the implementation automatically.</p>


<p><img src="http://springinpractice.s3.amazonaws.com/blog/images/2011-12-17-domain-modeling-with-spring-data-neo4j-code/repos.png" alt="Spring Data repositories" /></p>

<p>For <code>findByUsername()</code>, Spring Data can figure out what the intended query is there. For the other two queries, we use <code>@Query</code> and the <a title="Cypher query language" href="http://docs.neo4j.org/chunked/milestone/cypher-query-lang.html">Cypher query language</a> to specify the desired result set. The <code>{0}</code> in the queries refers to the finder method parameter. In the <code>findCollaborators()</code> query, we use <code>[:MEMBER_OF]</code> to indicate which relationship we want to follow. These return <code>Set</code>s instead of <code>Iterable</code>s to eliminate duplicates.</p>

<h2>Create the web controller</h2>

<p>We won&rsquo;t cover the entire controller here, but we&rsquo;ll cover some representative methods. Assume that we&rsquo;ve injected a PersonRepository into the controller.</p>

<p><strong>Creating a person.</strong> To create a person, we can use the following:</p>

<pre>@RequestMapping(value = "", method = RequestMethod.POST)
public String createPerson(Model model, @ModelAttribute Person person) {
Â Â Â  personRepo.save(person);
Â Â Â  return "redirect:/people?a=created";
}</pre>


<p>Once again, we&rsquo;re ignoring validation. All we have to do is call the save() method on the repository. That&rsquo;s how updates work too.</p>

<p><strong>Finding all people.</strong> Next, here&rsquo;s how we can get all people:</p>

<pre>@RequestMapping(value = "", method = RequestMethod.GET)
public String getPersonList(Model model) {
Â Â Â  Iterable&lt;Person&gt; personIt = personRepo.findAll();
Â Â Â  List&lt;Person&gt; people =
        new ArrayList&lt;Person&gt;(IteratorUtil.asCollection(personIt));
Â Â Â  Collections.sort(people);
Â Â Â  model.addAttribute(people);
Â Â Â  return "personList";
}</pre>


<p>We have to do some work to get the Iterable that PersonRepository.findAll() returns into the format we want. IteratorUtil, which comes with Neo4j (org.neo4j.helpers.collection.IteratorUtil), helps here.</p>

<p><strong>Finding a single person.</strong> Here we want to display the personal details we built out above. As with findAll(), we have to do some of the massaging ourselves:</p>

<pre>@RequestMapping(value = "/{username}", method = RequestMethod.GET)
public String getPersonDetails(@PathVariable String username, Model model) {
Â Â Â  Person person = personRepo.findByUsername(username);
Â Â Â  List&lt;ProjectMembership&gt; memberships =
        CollectionsUtil.asList(person.getMemberships());
Â Â Â  List&lt;Person&gt; directReports =
        CollectionsUtil.asList(person.getDirectReports());
Â Â Â  List&lt;Person&gt; collaborators =
        CollectionsUtil.asList(personRepo.findCollaborators(person));

Â Â Â  Collections.sort(directReports);
Â Â Â  Collections.sort(collaborators);

Â Â Â  model.addAttribute(person);
Â Â Â  model.addAttribute("memberships", memberships);
Â Â Â  model.addAttribute("directReports", directReports);
Â Â Â  model.addAttribute("collaborators", collaborators);

Â Â Â  return "personDetails";
}</pre>


<p>If you want to see the JSPs, check out the <a title="Zkybase GitHub site" href="http://skydingo.com/blog/?p=28">Zkybase GitHub site</a>.</p>

<h2>Configure the app</h2>

<p>Finally, here&rsquo;s my beans-service.xml file:</p>

<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
Â Â Â  xmlns:context="http://www.springframework.org/schema/context"
Â Â Â  xmlns:neo4j="http://www.springframework.org/schema/data/neo4j"
Â Â Â  xmlns:p="http://www.springframework.org/schema/p"
Â Â Â  xmlns:tx="http://www.springframework.org/schema/tx"
Â Â Â  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
Â Â Â  xsi:schemaLocation="
Â Â Â Â Â Â Â  http://www.springframework.org/schema/beans
Â Â Â Â Â Â Â  http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
Â Â Â Â Â Â Â  http://www.springframework.org/schema/context
Â Â Â Â Â Â Â  http://www.springframework.org/schema/context/spring-context-3.0.xsd
Â Â Â Â Â Â Â  http://www.springframework.org/schema/data/neo4j
Â Â Â Â Â Â Â  http://www.springframework.org/schema/data/neo4j/spring-neo4j-2.0.xsd
Â Â Â Â Â Â Â  http://www.springframework.org/schema/tx
Â Â Â Â Â Â Â  http://www.springframework.org/schema/tx/spring-tx-3.0.xsd"&gt;

Â Â Â  &lt;context:property-placeholder
        location="classpath:/spring/environment.properties" /&gt;
Â Â Â  &lt;context:annotation-config /&gt;
Â Â Â  &lt;context:component-scan base-package="org.skydingo.zkybase.service" /&gt;

Â Â Â  &lt;tx:annotation-driven mode="proxy" /&gt;

Â Â Â  &lt;neo4j:config storeDirectory="${graphDb.dir}" /&gt;
Â Â Â  &lt;neo4j:repositories base-package="org.skydingo.zkybase.repository" /&gt;
&lt;/beans&gt;</pre>


<p>Neo4j has a basic POJO-based mapping model and an advanced AspectJ-based mapping model. In this blog post we&rsquo;ve been using the basic POJO-based approach, so we don&rsquo;t need to include AspectJ-related configuration like &lt;context:spring-configured /&gt;.</p>

<p>There you have it&mdash;a Person CI backed by Neo4j. Happy coding!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/12/06/jackson-json-jaxb2-xml-spring/">Configuring Jackson to Use JAXB2 Annotations With Spring</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-06T14:17:40-08:00" pubdate data-updated="true">Dec 6<span>th</span>, 2011</time>
        
         | <a href="/2011/12/06/jackson-json-jaxb2-xml-spring/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>If you want to generate both XML and JSON views of some object, one option is to use JAXB2 annotations for the XML mapping and Jackson annotations for the JSON mapping. But that&rsquo;s a little bit of a nuisance, because you have to declare the what are essentially the same mappings twice. It turns out that it&rsquo;s possible to configure Jackson to use the JAXB2 annotations.</p>

<h3>Maven configuration</h3>


<p>First, make sure you have the <code>jackson-xc</code> dependency (in addition to the other Jackson dependencies) declared. This is the Maven dependency that supports using JAXB2 annotations:</p>

<pre>&lt;dependency&gt;
    &lt;groupId&gt;org.codehaus.jackson&lt;/groupId&gt;
    &lt;artifactId&gt;jackson-xc&lt;/artifactId&gt;
    &lt;version&gt;1.9.2&lt;/version&gt;
&lt;/dependency&gt;</pre>




<h3>Spring configuration</h3>


<p>Next, you&rsquo;ll need a bit of Spring configuration:</p>

<pre>&lt;oxm:jaxb2-marshaller id="marshaller"&gt;
    &lt;oxm:class-to-be-bound name="org.skydingo.skybase.model.Person" /&gt;
    &lt;oxm:class-to-be-bound name="org.skydingo.skybase.model.Project" /&gt;
&lt;/oxm:jaxb2-marshaller&gt;

&lt;bean id="jaxbAnnIntrospector"
    class="org.codehaus.jackson.xc.JaxbAnnotationIntrospector" /&gt;
&lt;bean id="jacksonObjectMapper" class="org.codehaus.jackson.map.ObjectMapper"&gt;
    &lt;property name="serializationConfig.annotationIntrospector"
        ref="jaxbAnnIntrospector" /&gt;
    &lt;property name="deserializationConfig.annotationIntrospector"
        ref="jaxbAnnIntrospector" /&gt;
&lt;/bean&gt;

&lt;bean class="org.springframework.web.servlet.view.ContentNegotiatingViewResolver"&gt;
    &lt;property name="mediaTypes"&gt;
        &lt;map&gt;
            &lt;entry key="html" value="text/html" /&gt;
            &lt;entry key="json" value="application/json" /&gt;
            &lt;entry key="xml" value="application/xml" /&gt;
        &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="viewResolvers"&gt;
        &lt;list&gt;
            &lt;bean class="org.springframework.web.servlet.view.InternalResourceViewResolver"
                p:prefix="/WEB-INF/jsp/"
                p:suffix=".jsp" /&gt;
        &lt;/list&gt;
    &lt;/property&gt;
    &lt;property name="defaultViews"&gt;
        &lt;list&gt;
            &lt;bean class="org.springframework.web.servlet.view.json.MappingJacksonJsonView"
                p:objectMapper-ref="jacksonObjectMapper"&gt;
                &lt;property name="renderedAttributes"&gt;
                    &lt;set&gt;
                        &lt;value&gt;person&lt;/value&gt;
                        &lt;value&gt;project&lt;/value&gt;
                    &lt;/set&gt;
                &lt;/property&gt;
            &lt;/bean&gt;
            &lt;bean class="org.springframework.web.servlet.view.xml.MarshallingView"
                p:marshaller-ref="marshaller" /&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre>


<p>Note the use of the compound property names when injecting into the Jackson <code>ObjectMapper</code>. That&rsquo;s a little-known but useful technique for performing injections in cases where constructor and simple property injection aren&rsquo;t options.</p>

<p>See also</p>

<ul>
    <li><a href="http://hillert.blogspot.com/2011/01/marshal-json-data-using-jackson-in.html">http://hillert.blogspot.com/2011/01/marshal-json-data-using-jackson-in.html</a></li>
    <li><a href="http://wiki.fasterxml.com/JacksonJAXBAnnotations">http://wiki.fasterxml.com/JacksonJAXBAnnotations</a></li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/5/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/3/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2013/10/27/how-to-send-an-http-header-with-every-request-with-spring-resttemplate/">How to send an HTTP header with every request with Spring RestTemplate</a>
      </li>
    
      <li class="post">
        <a href="/2013/10/25/know-which-apps-are-hitting-your-web-service/">Know which apps are hitting your web service</a>
      </li>
    
      <li class="post">
        <a href="/2013/10/09/generating-json-error-object-responses-with-spring-web-mvc/">Generating JSON error object responses with Spring Web MVC</a>
      </li>
    
      <li class="post">
        <a href="/2013/10/07/handling-json-error-object-responses-with-springs-resttemplate/">Handling JSON error object responses with Spring&#8217;s RestTemplate</a>
      </li>
    
      <li class="post">
        <a href="/2013/10/02/quick-tip-basic-authentication-with-spring-resttemplate/">Quick tip: Basic authentication with Spring RestTemplate</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/williewheeler">@williewheeler</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'williewheeler',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Willie Wheeler -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'springinpractice';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
